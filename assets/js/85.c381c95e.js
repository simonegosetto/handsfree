(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{434:function(e,t,n){"use strict";n.r(t);n(172),n(319),n(96),n(177),n(69),n(98),n(9),n(97);var i,s,a=n(23),o=n(46),r=(n(44),n(47),n(183),n(358)),d=(n(99),n(48)),h=n(101),c=n(100),l=(n(173),n(314),function(){function e(t,n){var i=arguments,s=this;Object(a.a)(this,e),this.handsfree=t,this.config=n,this.data={},this.dependenciesLoaded=!1,this.enabled=n.enabled,this.plugins=[],this.gestures=[],this.gestureEstimator=null,setTimeout((function(){var e=s.getData;s.getData=Object(d.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.apply(s,i);case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0={};case 5:return(n=t.t0).gesture=s.getGesture(),s.runPlugins(),t.abrupt("return",n);case 9:case"end":return t.stop()}}),t)})));var t=s.getGesture;s.getGesture=function(){return t||(t=function(){}),t.apply(s,i)}}),0)}return Object(o.a)(e,[{key:"loadDependencies",value:function(){}},{key:"updateData",value:function(){}},{key:"updateGestureEstimator",value:function(){}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.handsfree.config[this.name]=this.config,this.handsfree.config[this.name].enabled=this.enabled=!0,document.body.classList.add("handsfree-model-".concat(this.name)),e&&!this.dependenciesLoaded&&this.loadDependencies(),"weboji"===this.name&&(this.handsfree.debug.$canvas.weboji.style.display="block")}},{key:"disable",value:function(){var e=this;this.handsfree.config[this.name]=this.config,this.handsfree.config[this.name].enabled=this.enabled=!1,document.body.classList.remove("handsfree-model-".concat(this.name)),setTimeout((function(){var t;"weboji"===e.name?e.handsfree.debug.$canvas.weboji.style.display="none":(null===(t=e.handsfree.debug.context[e.name])||void 0===t?void 0:t.clearRect)&&e.handsfree.debug.context[e.name].clearRect(0,0,e.handsfree.debug.$canvas[e.name].width,e.handsfree.debug.$canvas[e.name].height);Object.keys(e.handsfree.model).some((function(t){return e.handsfree.model[t].enabled}))||e.handsfree.stop()}),0)}},{key:"loadDependency",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(i)t&&t();else{var s=document.createElement("script");s.async=!0,s.onload=function(){t&&t()},s.onerror=function(){n.handsfree.emit("modelError","Error loading ".concat(e))},s.src=e,document.body.appendChild(s)}}},{key:"runPlugins",value:function(){var e=this;this.data&&("handpose"!==this.name||this.data.annotations)&&Object.keys(this.data).length&&this.plugins.forEach((function(t){var n;e.handsfree.plugin[t].enabled&&(null===(n=e.handsfree.plugin[t])||void 0===n||n.onFrame(e.handsfree.data))}))}}]),e}()),u=n(359),f=n.n(u),g=function(e){Object(h.a)(i,e);var t,n=Object(c.a)(i);function i(e,t){var s;return Object(a.a)(this,i),(s=n.call(this,e,t)).name="hands",s.palmPoints=[0,5,9,13,17],s.gestureEstimator=new f.a.GestureEstimator([]),s}return Object(o.a)(i,[{key:"loadDependencies",value:function(e){var t=this;this.handsfree.config.isClient?this.loadDependency("".concat(this.handsfree.config.assetsPath,"/@mediapipe/drawing_utils.js"),(function(){t.onWarmUp(e)}),!!window.drawConnectors):this.loadDependency("".concat(this.handsfree.config.assetsPath,"/@mediapipe/hands/hands.js"),(function(){t.api=new window.Hands({locateFile:function(e){return"".concat(t.handsfree.config.assetsPath,"/@mediapipe/hands/").concat(e)}}),t.api.setOptions(t.handsfree.config.hands),t.api.onResults((function(e){return t.dataReceived(e)})),t.handsfree.getUserMedia((function(){t.handsfree.mediapipeWarmups.isWarmingUp?t.handsfree.on("mediapipeWarmedUp",(function(){t.handsfree.mediapipeWarmups.isWarmingUp||t.handsfree.mediapipeWarmups[t.name]||t.warmUp(e)})):t.warmUp(e)})),t.loadDependency("".concat(t.handsfree.config.assetsPath,"/@mediapipe/drawing_utils.js"),null,!!window.drawConnectors)}))}},{key:"warmUp",value:function(e){var t=this;this.handsfree.mediapipeWarmups[this.name]=!0,this.handsfree.mediapipeWarmups.isWarmingUp=!0,this.api.send({image:this.handsfree.debug.$video}).then((function(){t.handsfree.mediapipeWarmups.isWarmingUp=!1,t.onWarmUp(e)}))}},{key:"onWarmUp",value:function(e){this.dependenciesLoaded=!0,document.body.classList.add("handsfree-model-hands"),this.handsfree.emit("modelReady",this),this.handsfree.emit("handsModelReady",this),this.handsfree.emit("mediapipeWarmedUp",this),e&&e(this)}},{key:"getData",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.dependenciesLoaded,!e.t0){e.next=4;break}return e.next=4,this.api.send({image:this.handsfree.debug.$video});case 4:return e.abrupt("return",this.data);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"dataReceived",value:function(e){e.multiHandLandmarks&&(e=this.getCenterOfPalm(e)),e=this.forceHandedness(e),this.data=e,this.handsfree.data.hands=e,this.handsfree.isDebugging&&this.debug(e)}},{key:"forceHandedness",value:function(e){return e.landmarks=[[],[],[],[]],e.landmarksVisible=[!1,!1,!1,!1],e.multiHandLandmarks?(e.multiHandLandmarks.forEach((function(t,n){var i;i=n<2?"Right"===e.multiHandedness[n].label?0:1:"Right"===e.multiHandedness[n].label?2:3,e.landmarks[i]=t,e.landmarksVisible[i]=!0})),e):e}},{key:"getCenterOfPalm",value:function(e){var t=this;return e.multiHandLandmarks.forEach((function(n,i){var s=0,a=0;t.palmPoints.forEach((function(e){s+=n[e].x,a+=n[e].y})),s/=t.palmPoints.length,a/=t.palmPoints.length,e.multiHandLandmarks[i][21]={x:s,y:a}})),e}},{key:"debug",value:function(e){if("undefined"!=typeof drawConnectors&&(this.handsfree.debug.context.hands.clearRect(0,0,this.handsfree.debug.$canvas.hands.width,this.handsfree.debug.$canvas.hands.height),e.multiHandLandmarks)){var t,n=Object(r.a)(e.multiHandLandmarks);try{for(n.s();!(t=n.n()).done;){var i=t.value;drawConnectors(this.handsfree.debug.context.hands,i,HAND_CONNECTIONS,{color:"#00FF00",lineWidth:5}),drawLandmarks(this.handsfree.debug.context.hands,i,{color:"#FF0000",lineWidth:2})}}catch(e){n.e(e)}finally{n.f()}}}},{key:"updateGestureEstimator",value:function(){var e=this,t=[],n=[];this.gestures.forEach((function(n){if(e.handsfree.gesture[n].enabled&&(t.push(n),!e.handsfree.gesture[n].compiledDescription&&e.handsfree.gesture[n].enabled)){var i=new f.a.GestureDescription(n);e.handsfree.gesture[n].description.forEach((function(e){switch(e[0]){case"addCurl":i[e[0]](f.a.Finger[e[1]],f.a.FingerCurl[e[2]],e[3]);break;case"addDirection":i[e[0]](f.a.Finger[e[1]],f.a.FingerDirection[e[2]],e[3]);break;case"setWeight":i[e[0]](f.a.Finger[e[1]],e[2])}})),e.handsfree.gesture[n].compiledDescription=i}})),t.forEach((function(t){n.push(e.handsfree.gesture[t].compiledDescription)})),t.length&&(this.gestureEstimator=new f.a.GestureEstimator(n))}},{key:"getGesture",value:function(){var e=this,t=[null,null,null,null];return this.data.landmarks.forEach((function(n,i){if(e.data.landmarksVisible[i]){for(var s=[],a=0;a<21;a++)s.push([n[a].x*window.outerWidth,n[a].y*window.outerHeight,0]);var o=e.gestureEstimator.estimate(s,7.5);if(o.gestures.length?t[i]=o.gestures.reduce((function(t,n){var i=e.handsfree.gesture[n.name].confidence;return n.confidence>=i&&n.confidence>t.confidence?n:t})):t[i]={name:"",confidence:0},t[i].name){var r=e.handsfree.gesture[t[i].name].confidence;t[i].confidence<r&&(t[i]={name:"",confidence:0})}t[i].pose=o.poseData}})),t}}]),i}(l),p=function(e){Object(h.a)(i,e);var t,n=Object(c.a)(i);function i(e,t){var s;return Object(a.a)(this,i),(s=n.call(this,e,t)).name="facemesh",s.isWarmedUp=!1,s}return Object(o.a)(i,[{key:"loadDependencies",value:function(e){var t=this;this.handsfree.config.isClient?this.loadDependency("".concat(this.handsfree.config.assetsPath,"/@mediapipe/drawing_utils.js"),(function(){t.onWarmUp(e)}),!!window.drawConnectors):this.loadDependency("".concat(this.handsfree.config.assetsPath,"/@mediapipe/face_mesh/face_mesh.js"),(function(){t.api=new window.FaceMesh({locateFile:function(e){return"".concat(t.handsfree.config.assetsPath,"/@mediapipe/face_mesh/").concat(e)}}),t.api.setOptions(t.handsfree.config.facemesh),t.api.onResults((function(e){return t.dataReceived(e)})),t.handsfree.getUserMedia((function(){t.handsfree.mediapipeWarmups.isWarmingUp?t.handsfree.on("mediapipeWarmedUp",(function(){t.handsfree.mediapipeWarmups.isWarmingUp||t.handsfree.mediapipeWarmups[t.name]||t.warmUp(e)})):t.warmUp(e)})),t.loadDependency("".concat(t.handsfree.config.assetsPath,"/@mediapipe/drawing_utils.js"),null,!!window.drawConnectors)}))}},{key:"warmUp",value:function(e){var t=this;this.handsfree.mediapipeWarmups[this.name]=!0,this.handsfree.mediapipeWarmups.isWarmingUp=!0,this.api.send({image:this.handsfree.debug.$video}).then((function(){t.handsfree.mediapipeWarmups.isWarmingUp=!1,t.onWarmUp(e)}))}},{key:"onWarmUp",value:function(e){this.dependenciesLoaded=!0,document.body.classList.add("handsfree-model-facemesh"),this.handsfree.emit("modelReady",this),this.handsfree.emit("facemeshModelReady",this),this.handsfree.emit("mediapipeWarmedUp",this),e&&e(this)}},{key:"getData",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.dependenciesLoaded,!e.t0){e.next=4;break}return e.next=4,this.api.send({image:this.handsfree.debug.$video});case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"dataReceived",value:function(e){this.data=e,this.handsfree.data.facemesh=e,this.handsfree.isDebugging&&this.debug(e)}},{key:"debug",value:function(e){if("undefined"!=typeof drawConnectors&&(this.handsfree.debug.context.facemesh.clearRect(0,0,this.handsfree.debug.$canvas.facemesh.width,this.handsfree.debug.$canvas.facemesh.height),e.multiFaceLandmarks)){var t,n=Object(r.a)(e.multiFaceLandmarks);try{for(n.s();!(t=n.n()).done;){var i=t.value;drawConnectors(this.handsfree.debug.context.facemesh,i,FACEMESH_TESSELATION,{color:"#C0C0C070",lineWidth:1}),drawConnectors(this.handsfree.debug.context.facemesh,i,FACEMESH_RIGHT_EYE,{color:"#FF3030"}),drawConnectors(this.handsfree.debug.context.facemesh,i,FACEMESH_RIGHT_EYEBROW,{color:"#FF3030"}),drawConnectors(this.handsfree.debug.context.facemesh,i,FACEMESH_LEFT_EYE,{color:"#30FF30"}),drawConnectors(this.handsfree.debug.context.facemesh,i,FACEMESH_LEFT_EYEBROW,{color:"#30FF30"}),drawConnectors(this.handsfree.debug.context.facemesh,i,FACEMESH_FACE_OVAL,{color:"#E0E0E0"}),drawConnectors(this.handsfree.debug.context.facemesh,i,FACEMESH_LIPS,{color:"#E0E0E0"})}}catch(e){n.e(e)}finally{n.f()}}}}]),i}(l),m=function(e){Object(h.a)(i,e);var t,n=Object(c.a)(i);function i(e,t){var s;return Object(a.a)(this,i),(s=n.call(this,e,t)).name="pose",s.hasLoadedAndRun=!1,s.palmPoints=[0,1,2,5,9,13,17],s}return Object(o.a)(i,[{key:"loadDependencies",value:function(e){var t=this;this.handsfree.config.isClient?this.loadDependency("".concat(this.handsfree.config.assetsPath,"/@mediapipe/drawing_utils.js"),(function(){t.onWarmUp(e)}),!!window.drawConnectors):this.loadDependency("".concat(this.handsfree.config.assetsPath,"/@mediapipe/pose/pose.js"),(function(){t.api=new window.Pose({locateFile:function(e){return"".concat(t.handsfree.config.assetsPath,"/@mediapipe/pose/").concat(e)}}),t.api.setOptions(t.handsfree.config.pose),t.api.onResults((function(e){return t.dataReceived(e)})),t.handsfree.getUserMedia((function(){t.handsfree.mediapipeWarmups.isWarmingUp?t.handsfree.on("mediapipeWarmedUp",(function(){t.handsfree.mediapipeWarmups.isWarmingUp||t.handsfree.mediapipeWarmups[t.name]||t.warmUp(e)})):t.warmUp(e)})),t.loadDependency("".concat(t.handsfree.config.assetsPath,"/@mediapipe/drawing_utils.js"),null,!!window.drawConnectors)}))}},{key:"warmUp",value:function(e){var t=this;this.handsfree.mediapipeWarmups[this.name]=!0,this.handsfree.mediapipeWarmups.isWarmingUp=!0,this.api.send({image:this.handsfree.debug.$video}).then((function(){t.handsfree.mediapipeWarmups.isWarmingUp=!1,t.onWarmUp(e)}))}},{key:"onWarmUp",value:function(e){this.dependenciesLoaded=!0,document.body.classList.add("handsfree-model-pose"),this.handsfree.emit("modelReady",this),this.handsfree.emit("poseModelReady",this),this.handsfree.emit("mediapipeWarmedUp",this),e&&e(this)}},{key:"getData",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.dependenciesLoaded,!e.t0){e.next=4;break}return e.next=4,this.api.send({image:this.handsfree.debug.$video});case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"dataReceived",value:function(e){this.data=e,this.handsfree.data.pose=e,this.handsfree.isDebugging&&this.debug(e)}},{key:"debug",value:function(e){this.handsfree.debug.context.pose.clearRect(0,0,this.handsfree.debug.$canvas.pose.width,this.handsfree.debug.$canvas.pose.height),e.poseLandmarks&&(drawConnectors(this.handsfree.debug.context.pose,e.poseLandmarks,POSE_CONNECTIONS,{color:"#00FF00",lineWidth:4}),drawLandmarks(this.handsfree.debug.context.pose,e.poseLandmarks,{color:"#FF0000",lineWidth:2}))}}]),i}(l),b=(n(174),n(41)),w=n(328),v=function(e){Object(h.a)(i,e);var t,n=Object(c.a)(i);function i(e,t){var s;return Object(a.a)(this,i),(s=n.call(this,e,t)).name="handpose",s.three={scene:null,camera:null,renderer:null,meshes:[]},s.normalized=[],s.palmPoints=[0,1,2,5,9,13,17],s.gestureEstimator=new f.a.GestureEstimator([]),s}return Object(o.a)(i,[{key:"loadDependencies",value:function(e){var t=this;this.loadDependency("".concat(this.handsfree.config.assetsPath,"/three/three.min.js"),(function(){t.loadDependency("".concat(t.handsfree.config.assetsPath,"/@tensorflow/tf-core.js"),(function(){t.loadDependency("".concat(t.handsfree.config.assetsPath,"/@tensorflow/tf-converter.js"),(function(){t.loadDependency("".concat(t.handsfree.config.assetsPath,"/@tensorflow/tf-backend-").concat(t.handsfree.config.handpose.backend,".js"),(function(){t.loadDependency("".concat(t.handsfree.config.assetsPath,"/@tensorflow-models/handpose/handpose.js"),(function(){t.handsfree.getUserMedia(Object(d.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,window.tf.setBackend(t.handsfree.config.handpose.backend);case 2:return n.next=4,handpose.load(t.handsfree.config.handpose.model);case 4:t.api=n.sent,t.setup3D(),e&&e(t),t.dependenciesLoaded=!0,t.handsfree.emit("modelReady",t),t.handsfree.emit("handposeModelReady",t),document.body.classList.add("handsfree-model-handpose");case 11:case"end":return n.stop()}}),n)}))))}))}))}))}),!!window.tf)}),!!window.THREE)}},{key:"getData",value:(t=Object(d.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.handsfree.debug.$video){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.api.estimateHands(this.handsfree.debug.$video);case 4:return t=e.sent,this.handsfree.data.handpose=this.data=Object(w.a)(Object(w.a)({},t[0]),{},{normalized:this.normalized,meshes:this.three.meshes}),t[0]&&this.updateMeshes(this.data),this.three.renderer.render(this.three.scene,this.three.camera),e.abrupt("return",this.data);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setup3D",value:function(){this.three={scene:new window.THREE.Scene,camera:new window.THREE.PerspectiveCamera(90,window.outerWidth/window.outerHeight,.1,1e3),renderer:new THREE.WebGLRenderer({alpha:!0,canvas:this.handsfree.debug.$canvas.handpose}),meshes:[]},this.three.renderer.setSize(window.outerWidth,window.outerHeight),this.three.camera.position.z=this.handsfree.debug.$video.videoWidth/4,this.three.camera.lookAt(new window.THREE.Vector3(0,0,0)),this.three.screen=new window.THREE.Mesh(new window.THREE.BoxGeometry(window.outerWidth,window.outerHeight,1),new window.THREE.MeshNormalMaterial),this.three.screen.position.z=300,this.three.scene.add(this.three.screen),this.three.raycaster=new window.THREE.Raycaster,this.three.arrow=new window.THREE.ArrowHelper(this.three.raycaster.ray.direction,this.three.raycaster.ray.origin,300,16711680),this.three.scene.add(this.three.arrow);for(var e=0;e<21;e++){var t=this.getLandmarkProperty(e).isPalm,n=new window.THREE.Object3D,i=new window.THREE.CylinderGeometry(t?5:10,5,1),s=new window.THREE.MeshNormalMaterial,a=new window.THREE.Mesh(i,s);a.rotation.x=Math.PI/2,n.add(a),this.three.scene.add(n),this.three.meshes.push(n)}var o=new window.THREE.Object3D,r=new window.THREE.CylinderGeometry(5,5,1),d=new window.THREE.MeshNormalMaterial,h=new window.THREE.Mesh(r,d);h.rotation.x=Math.PI/2,this.three.centerPalmObj=o,o.add(h),this.three.scene.add(o),this.three.meshes.push(o),this.three.screen.visible=!1}},{key:"getLandmarkProperty",value:function(e){var t=[0,1,2,5,9,13,17],n=t.indexOf(e),i=-1!=n;return{isPalm:i,next:i?t[(n+1)%t.length]:e-1}}},{key:"updateMeshes",value:function(e){for(var t=0;t<this.three.meshes.length-1;t++){var n=this.getLandmarkProperty(t).next,i=this.webcam2space.apply(this,Object(b.a)(e.landmarks[t])),s=this.webcam2space.apply(this,Object(b.a)(e.landmarks[n])),a=i.clone().lerp(s,.5);if(this.three.meshes[t].position.set(a.x,a.y,a.z),this.normalized[t]=[this.handsfree.normalize(i.x,this.handsfree.debug.$video.videoWidth/-2,this.handsfree.debug.$video.videoWidth/2),this.handsfree.normalize(i.y,this.handsfree.debug.$video.videoHeight/-2,this.handsfree.debug.$video.videoHeight/2),this.three.meshes[t].position.z],this.three.meshes[t].scale.z=i.distanceTo(s),this.three.meshes[t].lookAt(s),8===t){this.three.arrow.position.set(a.x,a.y,a.z);var o=(new window.THREE.Vector3).subVectors(i,a);this.three.arrow.setDirection(o.normalize()),this.three.arrow.setLength(800),this.three.arrow.direction=o}}this.updateCenterPalmMesh(e)}},{key:"updateCenterPalmMesh",value:function(e){var t=this,n=[],i={x:0,y:0,z:0};this.palmPoints.forEach((function(s,a){n.push(t.webcam2space.apply(t,Object(b.a)(e.landmarks[s]))),i.x+=n[a].x,i.y+=n[a].y,i.z+=n[a].z})),i.x=i.x/this.palmPoints.length,i.y=i.y/this.palmPoints.length,i.z=i.z/this.palmPoints.length,this.three.centerPalmObj.position.set(i.x,i.y,i.z),this.three.centerPalmObj.scale.z=10,this.three.centerPalmObj.rotation.x=this.three.meshes[12].rotation.x-Math.PI/2,this.three.centerPalmObj.rotation.y=-this.three.meshes[12].rotation.y,this.three.centerPalmObj.rotation.z=this.three.meshes[12].rotation.z}},{key:"webcam2space",value:function(e,t,n){return new window.THREE.Vector3(e-this.handsfree.debug.$video.videoWidth/2,-(t-this.handsfree.debug.$video.videoHeight/2),-n)}},{key:"updateGestureEstimator",value:function(){var e=this,t=[],n=[];this.gestures.forEach((function(n){if(e.handsfree.gesture[n].enabled&&t.push(n),!e.handsfree.gesture[n].compiledDescription&&e.handsfree.gesture[n].enabled){var i=new f.a.GestureDescription(n);e.handsfree.gesture[n].description.forEach((function(e){switch(e[0]){case"addCurl":i[e[0]](f.a.Finger[e[1]],f.a.FingerCurl[e[2]],e[3]);break;case"addDirection":i[e[0]](f.a.Finger[e[1]],f.a.FingerDirection[e[2]],e[3]);break;case"setWeight":i[e[0]](f.a.Finger[e[1]],e[2])}})),e.handsfree.gesture[n].compiledDescription=i}})),t.forEach((function(t){n.push(e.handsfree.gesture[t].compiledDescription)})),t.length&&(this.gestureEstimator=new f.a.GestureEstimator(n))}},{key:"getGesture",value:function(){var e=null;if(this.data.landmarks&&this.gestureEstimator){var t=this.gestureEstimator.estimate(this.data.landmarks,7.5);t.gestures.length&&(e=t.gestures.reduce((function(e,t){return e.confidence>t.confidence?e:t})))}return e}}]),i}(l),y=function(e){Object(h.a)(n,e);var t=Object(c.a)(n);function n(e,i){var s;return Object(a.a)(this,n),(s=t.call(this,e,i)).name="weboji",s}return Object(o.a)(n,[{key:"loadDependencies",value:function(e){var t=this;this.handsfree.config.isClient?this.onReady(e):this.loadDependency("".concat(this.handsfree.config.assetsPath,"/jeeliz/jeelizFaceTransfer.js"),(function(){var n=t.handsfree.config.assetsPath+"/jeeliz/jeelizFaceTransferNNC.json";t.api=window.JEEFACETRANSFERAPI,fetch(n).then((function(e){return e.json()})).then((function(n){t.api.init({canvasId:"handsfree-canvas-weboji-".concat(t.handsfree.id),NNC:JSON.stringify(n),videoSettings:t.handsfree.config.weboji.videoSettings,callbackReady:function(){return t.onReady(e)}})})).catch((function(e){console.log(e),console.error("Couldn't load weboji tracking model at ".concat(n)),t.handsfree.emit("modelError",e)}))}))}},{key:"onReady",value:function(e){this.dependenciesLoaded=!0,this.handsfree.emit("modelReady",this),this.handsfree.emit("webojiModelReady",this),document.body.classList.add("handsfree-model-weboji"),e&&e(this)}},{key:"getData",value:function(){return this.data.rotation=this.api.get_rotationStabilized(),this.data.translation=this.api.get_positionScale(),this.data.morphs=this.api.get_morphTargetInfluencesStabilized(),this.data.state=this.getStates(),this.data.degree=this.getDegrees(),this.data.isDetected=this.api.is_detected(),this.handsfree.data.weboji=this.data,this.data}},{key:"getDegrees",value:function(){return[180*this.data.rotation[0]/Math.PI,180*this.data.rotation[1]/Math.PI,180*this.data.rotation[2]/Math.PI]}},{key:"getStates",value:function(){var e=this.data.morphs,t=this.data.state||{};return t.smileRight=e[0]>this.handsfree.config.weboji.morphs.threshold.smileRight,t.smileLeft=e[1]>this.handsfree.config.weboji.morphs.threshold.smileLeft,t.smile=t.smileRight&&t.smileLeft,t.smirk=t.smileRight&&!t.smileLeft||!t.smileRight&&t.smileLeft,t.pursed=e[7]>this.handsfree.config.weboji.morphs.threshold.mouthRound,t.browLeftUp=e[4]>this.handsfree.config.weboji.morphs.threshold.browLeftUp,t.browRightUp=e[5]>this.handsfree.config.weboji.morphs.threshold.browRightUp,t.browsUp=e[4]>this.handsfree.config.weboji.morphs.threshold.browLeftUp&&e[5]>this.handsfree.config.weboji.morphs.threshold.browLeftUp,t.browLeftDown=e[2]>this.handsfree.config.weboji.morphs.threshold.browLeftDown,t.browRightDown=e[3]>this.handsfree.config.weboji.morphs.threshold.browRightDown,t.browsDown=e[2]>this.handsfree.config.weboji.morphs.threshold.browLeftDown&&e[3]>this.handsfree.config.weboji.morphs.threshold.browLeftDown,t.browsUpDown=t.browLeftDown&&t.browRightUp||t.browRightDown&&t.browLeftUp,t.eyeLeftClosed=e[8]>this.handsfree.config.weboji.morphs.threshold.eyeLeftClosed,t.eyeRightClosed=e[9]>this.handsfree.config.weboji.morphs.threshold.eyeRightClosed,t.eyesClosed=t.eyeLeftClosed&&t.eyeRightClosed,t.mouthClosed=0===e[6],t.mouthOpen=e[6]>this.handsfree.config.weboji.morphs.threshold.mouthOpen,t}}]),n}(l),E=n(62),k=n(330),x=n.n(k),j=function(){function e(t,n){var i,s,o=this;Object(a.a)(this,e),this.plugin=t,this.handsfree=n,Object.keys(t).forEach((function(e){o[e]=t[e]}));var r=null===(i=n.config)||void 0===i||null===(s=i.plugin)||void 0===s?void 0:s[t.name];"boolean"==typeof r&&(r={enabled:r}),"object"===Object(E.a)(r)&&(x()(this.config,r),"boolean"==typeof r.enabled&&(this.enabled=r.enabled))}return Object(o.a)(e,[{key:"enable",value:function(){!this.enabled&&this.onEnable&&this.onEnable(this.handsfree),this.enabled=!0}},{key:"disable",value:function(){this.enabled&&this.onDisable&&this.onDisable(this.handsfree),this.enabled=!1}}]),e}(),$=function(e){Object(h.a)(n,e);var t=Object(c.a)(n);function n(e,i){var s;return Object(a.a)(this,n),(s=t.call(this,e,i)).algorithm="fingerpose",s.compiledDescription=null,s}return n}(function(){function e(t,n){var i,s,o=this;Object(a.a)(this,e),this.handsfree=n,Object.keys(t).forEach((function(e){o[e]=t[e]}));var r=null===(i=n.config)||void 0===i||null===(s=i.gesture)||void 0===s?void 0:s[t.name];"boolean"==typeof r&&(r={enabled:r}),"object"===Object(E.a)(r)&&(x()(this.config,r),"boolean"==typeof r.enabled&&(this.enabled=r.enabled))}return Object(o.a)(e,[{key:"enable",value:function(){this.enabled=!0,this.updateGestureEstimator()}},{key:"disable",value:function(){this.enabled=!1,this.updateGestureEstimator()}},{key:"updateGestureEstimator",value:function(){var e=this;this.models.forEach((function(t){e.handsfree.model[t].updateGestureEstimator()}))}}]),e}()),L={autostart:!1,assetsPath:"https://unpkg.com/handsfree@8.5.1/build/lib/assets",isClient:!1,gesture:{},setup:{canvas:{weboji:{$el:null,width:1280,height:720},hands:{$el:null,width:1280,height:720},handpose:{$el:null,width:1280,height:720},pose:{$el:null,width:1280,height:720},facemesh:{$el:null,width:1280,height:720}},video:{$el:null,width:1280,height:720},wrap:{$el:null,$parent:null}},weboji:{enabled:!1,throttle:0,videoSettings:{videoElement:null,deviceId:null,facingMode:"user",idealWidth:320,idealHeight:240,minWidth:240,maxWidth:1280,minHeight:240,maxHeight:1280},morphs:{threshold:{smileRight:.7,smileLeft:.7,browLeftDown:.8,browRightDown:.8,browLeftUp:.8,browRightUp:.8,eyeLeftClosed:.4,eyeRightClosed:.4,mouthOpen:.3,mouthRound:.8,upperLip:.5}}},hands:{enabled:!1,maxNumHands:2,minDetectionConfidence:.5,minTrackingConfidence:.5},facemesh:{enabled:!1,maxNumFaces:1,minDetectionConfidence:.5,minTrackingConfidence:.5},pose:{enabled:!1,upperBodyOnly:!1,smoothLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5},handpose:{enabled:!1,backend:"webgl",maxContinuousChecks:1/0,detectionConfidence:.8,iouThreshold:.3,scoreThreshold:.75},plugin:{}},P=n(364),D=n.n(P),O=n(430),S={models:"weboji",enabled:!1,tags:["browser"],$pointer:null,pointer:{x:-20,y:-20},tween:{x:0,y:0,positionList:[]},config:{offset:{x:0,y:0,pitch:10,yaw:0,roll:0},speed:{x:1,y:1}},onEnable:function(){var e;if(!this.$pointer){var t=document.createElement("div");t.classList.add("handsfree-pointer","handsfree-pointer-face","handsfree-hide-when-started-without-weboji"),document.body.appendChild(t),this.$pointer=t}null===(e=this.$pointer)||void 0===e||e.classList.remove("handsfree-hidden")},onFrame:function(e){var t=e.weboji,n=t.translation[0]*window.outerWidth,i=window.outerHeight-t.translation[1]*window.outerHeight,s=(1-t.translation[2])*window.outerWidth*2.5;n+=s*Math.tan(t.rotation[1]+this.config.offset.yaw*Math.PI/180)*this.config.speed.x,i+=s*Math.tan(t.rotation[0]+this.config.offset.pitch*Math.PI/180)*this.config.speed.y-window.outerHeight,n+=this.config.offset.x,i+=this.config.offset.y,this.handsfree.TweenMax.to(this.tween,1,{x:n,y:i,overwrite:!0,ease:"linear.easeNone",immediateRender:!0}),this.$pointer.style.left="".concat(this.tween.x,"px"),this.$pointer.style.top="".concat(this.tween.y,"px"),t.pointer={x:this.tween.x,y:this.tween.y}},onDisable:function(){var e;null===(e=this.$pointer)||void 0===e||e.classList.add("handsfree-hidden")}},T={models:"weboji",enabled:!1,tags:["browser"],config:{throttle:50,maxMouseDownedFrames:1,morphs:{0:.25,1:.25}},mouseDowned:0,mouseUp:!1,thresholdMet:!1,lastHeld:{x:0,y:0},$origTarget:null,onFrame:function(e){var t=this,n=e.weboji;this.thresholdMet=!1;var i="";Object.keys(this.config.morphs).forEach((function(e){var i=+t.config.morphs[e];i>0&&n.morphs[e]>=i&&(t.thresholdMet=!0)})),this.thresholdMet?(this.mouseDowned++,document.body.classList.add("handsfree-clicked")):(this.mouseUp=this.mouseDowned,this.mouseDowned=0,document.body.classList.remove("handsfree-clicked")),i=this.mouseDowned>0&&this.mouseDowned<=this.config.maxMouseDownedFrames?n.pointer.state="mousedown":this.mouseDowned>this.config.maxMouseDownedFrames?n.pointer.state="mousedrag":this.mouseUp?n.pointer.state="mouseup":"mousemove";var s=document.elementFromPoint(n.pointer.x,n.pointer.y);if(s&&"mousedown"===i&&(this.$origTarget=s),s){var a={view:window,button:0,bubbles:!0,cancelable:!0,clientX:n.pointer.x,clientY:n.pointer.y,movementX:n.pointer.x-this.lastHeld.x,movementY:n.pointer.y-this.lastHeld.y};s.dispatchEvent(new MouseEvent(i,a)),"mousedown"===n.pointer.state&&["INPUT","TEXTAREA","BUTTON","A"].includes(s.nodeName)&&s.focus(),"mouseup"===n.pointer.state&&s===this.$origTarget&&s.dispatchEvent(new MouseEvent("click",a)),n.pointer.$target=s}this.lastHeld=n.pointer}},R={models:"weboji",enabled:!1,tags:["browser"],numFramesFocused:0,$lastTarget:null,$target:null,config:{framesToFocus:10,vertScroll:{scrollSpeed:.05,scrollZone:100}},onUse:function(){this.$target=window},onFrame:function(e){var t=e.weboji;if(t.pointer.x||t.pointer.y){this.checkForFocus(t);var n,i=!1,s=this.getTargetScrollTop();n=this.$target.getBoundingClientRect?this.$target.getBoundingClientRect():{top:0,bottom:window.innerHeight},"mouseDown"===t.pointer.state&&(this.numFramesFocused=0,this.maybeSetTarget(t)),t.pointer.y<n.top+this.config.vertScroll.scrollZone&&(this.$target.scrollTo(0,s+(t.pointer.y-n.top-this.config.vertScroll.scrollZone)*this.config.vertScroll.scrollSpeed),i=!0),t.pointer.y>n.bottom-this.config.vertScroll.scrollZone&&(this.$target.scrollTo(0,s-(n.bottom-t.pointer.y-this.config.vertScroll.scrollZone)*this.config.vertScroll.scrollSpeed),i=!0),i&&this.maybeSelectNewTarget()}},maybeSelectNewTarget:function(){var e=this.getTargetScrollTop(),t=!1;this.$target.scrollTo(0,e+this.config.vertScroll.scrollSpeed),e===this.getTargetScrollTop()?(t=!0,this.$target.scrollTo(0,e-this.config.vertScroll.scrollSpeed),e===this.getTargetScrollTop()?t&&(this.numFramesFocused=0,this.selectTarget(this.recursivelyFindScrollbar(this.$target.parentElement))):this.$target.scrollTo(0,e+this.config.vertScroll.scrollSpeed)):this.$target.scrollTo(0,e-this.config.vertScroll.scrollSpeed)},getTargetScrollTop:function(){var e,t;return(null===(e=this.$target)||void 0===e?void 0:e.scrollY)||(null===(t=this.$target)||void 0===t?void 0:t.scrollTop)||0},checkForFocus:D()((function(e){var t=document.elementFromPoint(e.pointer.x,e.pointer.y);t&&((t=this.recursivelyFindScrollbar(t))===this.$lastTarget?++this.numFramesFocused:this.numFramesFocused=0,this.numFramesFocused>this.config.framesToFocus&&this.selectTarget(t),this.$lastTarget=t)}),100),selectTarget:function(e){this.$target.classList&&this.$target.classList.remove("handsfree-scroll-focus"),e&&e.classList&&e.classList.add("handsfree-scroll-focus"),"HTML"!==e.nodeName&&e.nodeName||(e=window),this.$target=e},maybeSetTarget:function(e){"mouseDown"===e.pointer.state&&e.pointer.$target&&this.selectTarget(this.recursivelyFindScrollbar(e.pointer.$target))},recursivelyFindScrollbar:function(e){var t=e&&e.getBoundingClientRect?getComputedStyle(e):{};return e&&e.scrollHeight>e.clientHeight&&("auto"===t.overflow||"auto scroll"===t.overflow||"auto"===t.overflowY||"auto scroll"===t.overflowY)?e:e&&e.parentElement?this.recursivelyFindScrollbar(e.parentElement):window}},F={models:"hands",tags:["browser"],enabled:!1,numFramesFocused:[0,0,0,0],$target:[null,null,null,null],origScrollLeft:[0,0,0,0],origScrollTop:[0,0,0,0],tweenScroll:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],config:{framesToFocus:10,threshold:50,numThresholdErrorFrames:5,speed:1},onFrame:function(e){var t=this,n=e.hands;setTimeout((function(){if(n.pointer){var e=t.handsfree.debug.$canvas.hands.height,i=t.handsfree.debug.$canvas.hands.width;n.pointer.forEach((function(s,a){var o,r;if(s.isVisible&&!(a>n.origPinch.length)){if("start"===(null===(o=n.pinchState[a])||void 0===o?void 0:o[0])){var d=document.elementFromPoint(s.x,s.y);t.$target[a]=t.getTarget(d),t.tweenScroll[a].x=t.origScrollLeft[a]=t.getTargetScrollLeft(t.$target[a]),t.tweenScroll[a].y=t.origScrollTop[a]=t.getTargetScrollTop(t.$target[a]),t.handsfree.TweenMax.killTweensOf(t.tweenScroll[a])}"held"===(null===(r=n.pinchState[a])||void 0===r?void 0:r[0])&&t.$target[a]&&(t.handsfree.TweenMax.to(t.tweenScroll[a],1,{x:t.tweenScroll[a].x-(n.origPinch[a][0].x-n.curPinch[a][0].x)*i*t.config.speed,y:t.tweenScroll[a].y+(n.origPinch[a][0].y-n.curPinch[a][0].y)*e*t.config.speed,overwrite:!0,ease:"linear.easeNone",immediateRender:!0}),t.$target[a].scrollTo(t.tweenScroll[a].x,t.tweenScroll[a].y))}}))}}))},getTarget:function(e){var t=e&&e.getBoundingClientRect?getComputedStyle(e):{};return e&&e.scrollHeight>e.clientHeight&&("auto"===t.overflow||"auto scroll"===t.overflow||"auto"===t.overflowY||"auto scroll"===t.overflowY)?e:e&&e.parentElement?this.getTarget(e.parentElement):window},getTargetScrollLeft:function(e){return e.scrollX||e.scrollLeft||0},getTargetScrollTop:function(e){return e.scrollY||e.scrollTop||0}},C=n(321),H=(i={models:"hands",enabled:!0,tags:["core"],fingertipIndex:[8,12,16,20],numFramesFocused:[[0,0,0,0],[0,0,0,0]],thresholdMet:[[0,0,0,0],[0,0,0,0]],framesSinceLastGrab:[[0,0,0,0],[0,0,0,0]],origPinch:[[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]],curPinch:[[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]],pinchDowned:[[0,0,0,0],[0,0,0,0]],pinchDown:[[!1,!1,!1,!1],[!1,!1,!1,!1]],pinchUp:[[!1,!1,!1,!1],[!1,!1,!1,!1]],tween:[[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]]},Object(C.a)(i,"numFramesFocused",[[0,0,0,0],[0,0,0,0]]),Object(C.a)(i,"mouseDowned",0),Object(C.a)(i,"mouseUp",!1),Object(C.a)(i,"mouseThresholdMet",!1),Object(C.a)(i,"config",{framesToFocus:10,threshold:50,numThresholdErrorFrames:5,maxMouseDownedFrames:1}),Object(C.a)(i,"onUse",(function(){this.$target=window})),Object(C.a)(i,"onFrame",(function(e){var t=e.hands;if(t.multiHandLandmarks){for(var n=this.handsfree.debug.$canvas.hands.height,i=t.multiHandedness.some((function(e){return"Right"===e.label})),s=t.multiHandedness.some((function(e){return"Left"===e.label})),a=0;a<t.multiHandLandmarks.length;a++)for(var o="Right"===t.multiHandedness[a].label?0:1,r=0;r<4;r++){var d=t.multiHandLandmarks[a][4].x-t.multiHandLandmarks[a][this.fingertipIndex[r]].x,h=t.multiHandLandmarks[a][4].y-t.multiHandLandmarks[a][this.fingertipIndex[r]].y,c=Math.sqrt(d*d+h*h)*n;(this.thresholdMet[o][r]=c<this.config.threshold)&&(this.curPinch[o][r]=t.multiHandLandmarks[a][4],this.framesSinceLastGrab[o][r]>this.config.numThresholdErrorFrames&&(this.origPinch[o][r]=t.multiHandLandmarks[a][4],this.handsfree.TweenMax.killTweensOf(this.tween[o][r])),this.framesSinceLastGrab[o][r]=0),++this.framesSinceLastGrab[o][r]}t.origPinch=this.origPinch,t.curPinch=this.curPinch,this.handsfree.data.hands=this.getPinchStates(t,i,s)}})),Object(C.a)(i,"getPinchStates",(function(e,t,n){var i=[t,n];e.pinchState=[["","","",""],["","","",""]];for(var s=0;s<2;s++)for(var a=0;a<4;a++)i[s]&&this.thresholdMet[s][a]?(this.pinchDowned[s][a]++,document.body.classList.add("handsfree-finger-pinched-".concat(s,"-").concat(a),"handsfree-finger-pinched-".concat(a))):(this.pinchUp[s][a]=this.pinchDowned[s][a],this.pinchDowned[s][a]=0,document.body.classList.remove("handsfree-finger-pinched-".concat(s,"-").concat(a),"handsfree-finger-pinched-".concat(a))),this.pinchDowned[s][a]>0&&this.pinchDowned[s][a]<=this.config.maxMouseDownedFrames?e.pinchState[s][a]="start":this.pinchDowned[s][a]>this.config.maxMouseDownedFrames?e.pinchState[s][a]="held":this.pinchUp[s][a]?e.pinchState[s][a]="released":e.pinchState[s][a]="",e.pinchState[s][a]&&(this.handsfree.emit("finger-pinched-".concat(s,"-").concat(a),{event:e.pinchState[s][a],origPinch:e.origPinch[s][a],curPinch:e.curPinch[s][a]}),this.handsfree.emit("finger-pinched-".concat(e.pinchState[s][a],"-").concat(s,"-").concat(a),{event:e.pinchState[s][a],origPinch:e.origPinch[s][a],curPinch:e.curPinch[s][a]}),this.handsfree.emit("finger-pinched-".concat(a),{event:e.pinchState[s][a],origPinch:e.origPinch[s][a],curPinch:e.curPinch[s][a]}),this.handsfree.emit("finger-pinched-".concat(e.pinchState[s][a],"-").concat(a),{event:e.pinchState[s][a],origPinch:e.origPinch[s][a],curPinch:e.curPinch[s][a]}));return e})),i),U={start:"mousedown",held:"mousemove",released:"mouseup"},M=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],W={facePointer:S,faceClick:T,faceScroll:R,pinchScroll:F,pinchers:H,palmPointers:(s={models:"hands",tags:["browser"],enabled:!1,$pointer:[],arePointersVisible:!0,pointer:[{x:-20,y:-20,isVisible:!1},{x:-20,y:-20,isVisible:!1},{x:-20,y:-20,isVisible:!1},{x:-20,y:-20,isVisible:!1}],tween:[{x:-20,y:-20},{x:-20,y:-20},{x:-20,y:-20},{x:-20,y:-20}],config:{offset:{x:0,y:0},speed:{x:1,y:1}},onUse:function(){for(var e=0;e<4;e++){var t=document.createElement("div");t.classList.add("handsfree-pointer","handsfree-pointer-palm","handsfree-hide-when-started-without-hands"),document.body.appendChild(t),this.$pointer[e]=t}this.enabled&&this.arePointersVisible?this.showPointers():this.hidePointers()},onEnable:function(){var e=this.arePointersVisible;this.showPointers(),this.arePointersVisible=e},onDisable:function(){var e=this.arePointersVisible;this.hidePointers(),this.arePointersVisible=e},onFrame:function(e){var t=this,n=e.hands;null!=n&&n.multiHandLandmarks?(n.pointer=[{isVisible:!1},{isVisible:!1},{isVisible:!1},{isVisible:!1}],n.multiHandLandmarks.forEach((function(e,i){var s,a,o,r=n.pointer[i];o=i<2?"Right"===n.multiHandedness[i].label?0:1:"Right"===n.multiHandedness[i].label?2:3,t.handsfree.TweenMax.to(t.tween[o],1,{x:window.outerWidth*t.config.speed.x-window.outerWidth*t.config.speed.x/2+window.outerWidth/2-n.multiHandLandmarks[i][21].x*t.config.speed.x*window.outerWidth+t.config.offset.x,y:n.multiHandLandmarks[i][21].y*window.outerHeight*t.config.speed.y-window.outerHeight*t.config.speed.y/2+window.outerHeight/2+t.config.offset.y,overwrite:!0,ease:"linear.easeNone",immediate:!0}),n.pointer[o]={x:t.tween[o].x,y:t.tween[o].y,isVisible:!0},t.$pointer[o].style.left="".concat(t.tween[o].x,"px"),t.$pointer[o].style.top="".concat(t.tween[o].y,"px");var d=null==r||null===(s=r.pinchState)||void 0===s||null===(a=s[i])||void 0===a?void 0:a[0];if(d&&r.isVisible){d=U[d];var h=document.elementFromPoint(r.x,r.y);h&&h.dispatchEvent(new MouseEvent(d,{view:window,button:0,bubbles:!0,cancelable:!0,clientX:r.x,clientY:r.y,movementX:r.x-M[o].x,movementY:r.y-M[o].y})),M[o]=r}})),n.pointer.forEach((function(e,n){e.isVisible?t.$pointer[n].style.display="block":t.$pointer[n].style.display="none"}))):this.$pointer.forEach((function(e){return e.style.display="none"}))}},Object(C.a)(s,"onDisable",(function(){this.$pointer.forEach((function(e){e.classList.add("handsfree-hidden")}))})),Object(C.a)(s,"showPointers",(function(){this.arePointersVisible=!0;for(var e=0;e<4;e++)this.$pointer[e].classList.remove("handsfree-hidden")})),Object(C.a)(s,"hidePointers",(function(){this.arePointersVisible=!1;for(var e=0;e<4;e++)this.$pointer[e].classList.add("handsfree-hidden")})),s)},G=0,A=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(a.a)(this,e),this.throttle=D.a,this.TweenMax=O.a,this.id=++G,this.version="8.5.1",this.data={},this.dependencies={loading:[],loaded:[]},this.mediapipeWarmups={isWarmingUp:!1,hands:!1,pose:!1,facemesh:!1},this.plugin={},this.taggedPlugins={untagged:[]},this.gesture={},this.taggedGestures={untagged:[]},this.config=this.cleanConfig(n),this.setupDebugger(),this.prepareModels(),this.loadCorePlugins(),this.hasAddedBodyClass=!1,this.isUpdating=!1,this.numModelsLoaded=0,this.on("modelReady",(function(){var e=0;Object.keys(t.model).forEach((function(n){t.model[n].enabled&&++e})),++t.numModelsLoaded===e&&(document.body.classList.remove("handsfree-loading"),document.body.classList.add("handsfree-started"),t.hasAddedBodyClass=!0,!t.config.isClient&&(!t.isUpdating||t.isUpdating&&t.config.autostart)&&(t.isLooping=!0,t.loop()))})),this.emit("init",this)}return Object(o.a)(e,[{key:"prepareModels",value:function(){this.model={weboji:{},hands:{},facemesh:{},pose:{},handpose:{}},this.model.weboji=new y(this,this.config.weboji),this.model.hands=new g(this,this.config.hands),this.model.pose=new m(this,this.config.pose),this.model.facemesh=new p(this,this.config.facemesh),this.model.handpose=new v(this,this.config.handpose)}},{key:"cleanConfig",value:function(e,t){return t||(t=Object.assign({},L)),t.setup.wrap.$parent=document.body,"boolean"==typeof e.weboji&&(e.weboji={enabled:e.weboji}),"boolean"==typeof e.hands&&(e.hands={enabled:e.hands}),"boolean"==typeof e.facemesh&&(e.facemesh={enabled:e.facemesh}),"boolean"==typeof e.pose&&(e.pose={enabled:e.pose}),"boolean"==typeof e.handpose&&(e.handpose={enabled:e.handpose}),e.plugin&&Object.keys(e.plugin).forEach((function(t){"boolean"==typeof e.plugin[t]&&(e.plugin[t]={enabled:e.plugin[t]})})),e.gesture&&Object.keys(e.gesture).forEach((function(t){"boolean"==typeof e.gesture[t]&&(e.gesture[t]={enabled:e.gesture[t]})})),x()({},t,e)}},{key:"update",value:function(e,t){var n=this;this.config=this.cleanConfig(e,this.config),this.isUpdating=!0,this.isUsingWebcam=!this.config.setup.video.$el.currentSrc,this.debug.$video=this.config.setup.video.$el,this.debug.$video.width=this.config.setup.video.width,this.debug.$video.height=this.config.setup.video.height,["hands","facemesh","pose","handpose","weboji"].forEach((function(t){var i=n.model[t].enabled;n.config[t]=n.model[t].config=x()({},n.model[t].config,e[t]),i&&!n.config[t].enabled?n.model[t].disable():!i&&n.config[t].enabled&&n.model[t].enable(!1)})),e.plugin&&Object.keys(e.plugin).forEach((function(t){"boolean"==typeof e.plugin[t].enabled&&(e.plugin[t].enabled?n.plugin[t].enable():n.plugin[t].disable())})),e.gesture&&Object.keys(e.gesture).forEach((function(t){"boolean"==typeof e.gesture[t].enabled&&(e.gesture[t].enabled?n.gesture[t].enable():n.gesture[t].disable())})),!this.config.isClient&&this.config.autostart?this.start(t):t&&t()}},{key:"start",value:function(e){var t=this;this.config=this.cleanConfig(this.config,this.config),this.isUpdating=!1,document.body.classList.add("handsfree-loading"),this.emit("loading",this),e&&this.on("modelReady",e,{once:!0}),this.numModelsLoaded=0,Object.keys(this.model).forEach((function(e){var n=t.model[e];n.enabled&&!n.dependenciesLoaded?n.loadDependencies():n.enabled&&(t.emit("modelReady",n),t.emit("".concat(e,"ModelReady"),n))})),Object.keys(this.config.plugin).forEach((function(e){var n,i;"boolean"==typeof(null===(n=t.config.plugin)||void 0===n||null===(i=n[e])||void 0===i?void 0:i.enabled)&&t.config.plugin[e].enabled&&t.plugin[e].enable()})),Object.keys(this.config.gesture).forEach((function(e){var n,i;"boolean"==typeof(null===(n=t.config.gesture)||void 0===n||null===(i=n[e])||void 0===i?void 0:i.enabled)&&t.config.gesture[e].enabled&&t.gesture[e].enable()}))}},{key:"stop",value:function(){location.reload()}},{key:"pause",value:function(){this.isLooping=!1}},{key:"unpause",value:function(){this.isLooping||(this.isLooping=!0,this.loop())}},{key:"loop",value:function(){var e,t=this;(Object.keys(this.model).forEach((function(e){var n=t.model[e];n.enabled&&n.dependenciesLoaded&&n.getData()})),this.emit("data",this.data),null===(e=this.taggedPlugins.untagged)||void 0===e||e.forEach((function(e){var n;t.plugin[e].enabled&&(null===(n=t.plugin[e])||void 0===n||n.onFrame(t.data))})),this.isDebugging)&&(["hands","pose","handpose","facemesh"].find((function(e){if(t.model[e].enabled)return e}))&&this.debug.context.video.drawImage(this.debug.$video,0,0,this.debug.$canvas.video.width,this.debug.$canvas.video.height));this.isLooping&&requestAnimationFrame((function(){return t.isLooping&&t.loop()}))}},{key:"use",value:function(e,t){var n=this;return"function"==typeof t&&(t={onFrame:t}),"string"==typeof(t=x()({},{name:e,models:[],tags:[],enabled:!0,config:{},onFrame:null,onUse:null,onEnable:null,onDisable:null},t)).models&&(t.models=[t.models]),"string"==typeof t.tags&&(t.tags=[t.tags]),t.tags.forEach((function(t){n.taggedPlugins[t]||(n.taggedPlugins[t]=[]),n.taggedPlugins[t].push(e)})),this.plugin[e]=new j(t,this),this.plugin[e].onUse&&this.plugin[e].onUse(),t.models.length?t.models.forEach((function(t){n.model[t].plugins.push(e)})):this.taggedPlugins.untagged.push(e),this.plugin[e]}},{key:"enablePlugins",value:function(e){var t=this;"string"==typeof e&&(e=[e]),e||(e=Object.keys(this.taggedPlugins)),e.forEach((function(e){t.taggedPlugins[e].forEach((function(e){t.plugin[e].enable()}))}))}},{key:"disablePlugins",value:function(e){var t=this;"string"==typeof e&&(e=[e]),e||(e=Object.keys(this.taggedPlugins)),e.forEach((function(e){t.taggedPlugins[e].forEach((function(e){t.plugin[e].disable()}))}))}},{key:"runPlugins",value:function(e){var t,n=this;this.data=e,this.config.isClient&&!this.hasAddedBodyClass&&(document.body.classList.add("handsfree-started"),this.hasAddedBodyClass=!0),Object.keys(this.model).forEach((function(t){n.model[t].data=null==e?void 0:e[t],n.model[t].runPlugins()})),null===(t=this.taggedPlugins.untagged)||void 0===t||t.forEach((function(e){var t;n.plugin[e].enabled&&(null===(t=n.plugin[e])||void 0===t||t.onFrame(n.data))}))}},{key:"useGesture",value:function(e){var t=this;switch("string"==typeof(e=x()({},{name:"untitled",description:[],models:[],tags:[],enabled:!0},e)).models&&(e.models=[e.models]),"string"==typeof e.tags&&(e.tags=[e.tags]),e.tags.forEach((function(n){t.taggedGestures[n]||(t.taggedGestures[n]=[]),t.taggedGestures[n].push(e.name)})),e.algorithm){case"fingerpose":this.gesture[e.name]=new $(e,this)}return e.models.length?e.models.forEach((function(n){t.model[n].gestures.push(e.name),t.model[n].updateGestureEstimator()})):this.taggedGestures.untagged.push(e.name),this.gesture[e.name]}},{key:"enableGestures",value:function(e){var t=this;"string"==typeof e&&(e=[e]),e||(e=Object.keys(this.taggedGestures)),e.forEach((function(e){t.taggedGestures[e].forEach((function(e){t.gesture[e].enable()}))}))}},{key:"disableGestures",value:function(e){var t=this;"string"==typeof e&&(e=[e]),e||(e=Object.keys(this.taggedGestures)),e.forEach((function(e){t.taggedGestures[e].forEach((function(e){t.gesture[e].disable()}))}))}},{key:"emit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new CustomEvent("handsfree-".concat(e),{detail:t});document.dispatchEvent(n)}},{key:"on",value:function(e,t,n){document.addEventListener("handsfree-".concat(e),(function(e){t(e.detail)}),n)}},{key:"normalize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(e-n)/(t-n)}},{key:"getUserMedia",value:function(e){var t,n,i=this;this.debug.stream||this.debug.isGettingStream?!this.debug.stream&&this.debug.isGettingStream?e&&this.on("gotUserMedia",e):(this.debug.$video.play(),this.emit("gotUserMedia",this.debug.stream),e&&e()):this.isUsingWebcam&&null!==(t=this.model.weboji)&&void 0!==t&&null!==(n=t.api)&&void 0!==n&&n.get_videoStream?(this.debug.$video=this.model.weboji.api.get_video(),this.debug.$video.srcObject=this.debug.stream=this.model.weboji.api.get_videoStream(),this.emit("gotUserMedia",this.debug.stream),e&&e()):this.isUsingWebcam?(this.debug.isGettingStream=!0,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:this.debug.$video.width,height:this.debug.$video.height}}).then((function(t){i.debug.$video.srcObject=i.debug.stream=t,i.debug.$video.onloadedmetadata=function(){i.debug.$video.play(),i.emit("gotUserMedia",t),e&&e()}})).catch((function(e){console.error("Error getting user media: ".concat(e))})).finally((function(){i.debug.isGettingStream=!1}))):(this.debug.stream=this.debug.$video.srcObject,this.debug.$video.play(),this.emit("gotUserMedia",this.debug.stream),e&&e(),this.debug.isGettingStream=!1)}},{key:"loadCorePlugins",value:function(){var e=this;Object.keys(W).forEach((function(t){e.use(t,W[t])}))}},{key:"setupDebugger",value:function(){var e=this;if(this.debug={},!this.config.setup.wrap.$el){var t=document.createElement("DIV");t.classList.add("handsfree-debugger"),this.config.setup.wrap.$el=t}if(this.debug.$wrap=this.config.setup.wrap.$el,this.config.setup.video.$el)this.debug.$video=this.config.setup.video.$el,this.isUsingWebcam=!1;else{var n=document.createElement("VIDEO");n.setAttribute("playsinline",!0),n.classList.add("handsfree-video"),n.setAttribute("id","handsfree-video-".concat(this.id)),this.config.setup.video.$el=n,this.isUsingWebcam=!0,this.debug.$video=this.config.setup.video.$el,this.debug.$wrap.appendChild(this.debug.$video)}this.debug.$video.width=this.config.setup.video.width,this.debug.$video.height=this.config.setup.video.height,this.debug.$canvas={},this.debug.context={},this.config.setup.canvas.video={width:this.debug.$video.width,height:this.debug.$video.height},["video","weboji","facemesh","pose","hands","handpose"].forEach((function(t){e.debug.$canvas[t]={},e.debug.context[t]={};var n=e.config.setup.canvas[t].$el;n||(n=document.createElement("CANVAS"),e.config.setup.canvas[t].$el=n),n.classList.add("handsfree-canvas","handsfree-canvas-".concat(t),"handsfree-hide-when-started-without-".concat(t)),n.setAttribute("id","handsfree-canvas-".concat(t,"-").concat(e.id)),e.debug.$canvas[t]=e.config.setup.canvas[t].$el,e.debug.$canvas[t].width=e.config.setup.canvas[t].width,e.debug.$canvas[t].height=e.config.setup.canvas[t].height,e.debug.$wrap.appendChild(e.debug.$canvas[t]),["weboji","handpose"].includes(t)?e.debug.$canvas[t].classList.add("handsfree-canvas-webgl"):e.debug.context[t]=e.debug.$canvas[t].getContext("2d")})),this.config.setup.wrap.$parent.appendChild(this.debug.$wrap),this.config.showDebug?this.showDebugger():this.hideDebugger()}},{key:"showDebugger",value:function(){this.isDebugging=!0,document.body.classList.add("handsfree-show-debug"),document.body.classList.remove("handsfree-hide-debug")}},{key:"hideDebugger",value:function(){this.isDebugging=!1,document.body.classList.remove("handsfree-show-debug"),document.body.classList.add("handsfree-hide-debug")}}]),e}();t.default=A}}]);